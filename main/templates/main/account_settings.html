{% extends 'base.html' %}
{% load static %}

{% block title %} Account Settings {% endblock %}
{% block css_files %}
  <link rel="stylesheet" href="{% static "css/styles.css" %}">
{% endblock %}

{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
  <h1 class="header">Account Settings</h1>

 <!-- Account Info Form -->
  <form method="post">
    {% csrf_token %}
    <fieldset>
      <legend>Account Info</legend>
      {{ info_form|crispy }}
    </fieldset>
    <button type="submit" name="save_info" class="btn btn-primary">Save Account Info</button>
  </form>

  <!-- Email Preferences Form -->
  <form method="post" class="mt-5">
    {% csrf_token %}
    <fieldset>
      <legend>Email Notification Preferences</legend>
      {{ email_form|crispy }}
    </fieldset>
    <button type="submit" name="save_email_prefs" class="btn btn-primary">Save Email Preferences</button>
  </form>

  <!-- Password Change Form -->
<form method="post" class="mt-5">
  {% csrf_token %}
  <fieldset>
    <legend>Change Password</legend>
    {{ password_form|crispy }}
  </fieldset>
  <button type="submit" name="change_password" class="btn btn-primary">Change Password</button>
</form>

</div>
{% endblock %}

{% block scripts %}
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('account-info-form');
        const saveButton = document.getElementById('save-button');

        const initialData = new FormData(form);

        form.addEventListener('input', function () {
        const currentData = new FormData(form);
        let changed = false;

        for (const [key, value] of currentData.entries()) {
            if (value !== initialData.get(key)) {
            changed = true;
            break;
            }
        }

        saveButton.disabled = !changed;
        });
    });
    </script>
{% endblock %}