<div class="comment" style="margin-left: {{ level }}em;">
    {% include 'main/comment_text.html' %}
</div>

{% for reply in comment.replies.all %}
    {% include 'main/comment_thread.html' with comment=reply level=level|add:1 redirect_url=redirect_url top_level_comment=top_level_comment %}
{% endfor %}

{% if forloop.last %}
    <div id="comment-{{ top_level_comment.id }}-container" class="reply-container">
        {% include 'main/reply_form.html' with reply_recipient=top_level_comment.sender.first_name redirect_url=redirect_url top_level_comment=top_level_comment %}
    </div>
{% endif %}



{% comment %} 
<div class="comment" style="margin-left: {{ level }}em;">
    {% include 'main/comment_text.html' %}
    {% if not comment.replies.all %}
         {% include 'main/reply_form.html' with reply_recipient=comment.sender.first_name redirect_url=redirect_url%}
    {% endif %}
    {% for reply in comment.replies.all %}
        {% include 'main/comment_text.html' with comment=reply level=1%}
        {% if forloop.last %}
        {% include 'main/reply_form.html' with reply_recipient=comment.sender.first_name redirect_url=redirect_url%}
        {% endif %}
    {% endfor %}
</div> {% endcomment %}
