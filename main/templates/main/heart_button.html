{# Decide initial liked state. Prefer explicit is_liked, else fall back to liked_pieces. #}

{% if is_liked is not None %}
  {% with initial_liked=is_liked %}
    {% include "main/_heart_button_inner.html" %}
  {% endwith %}
{% elif liked_pieces and piece.id in liked_pieces %}
  {% with initial_liked=True %}
    {% include "main/_heart_button_inner.html" %}
  {% endwith %}
{% else %}
  {% with initial_liked=False %}
    {% include "main/_heart_button_inner.html" %}
  {% endwith %}
{% endif %}