{# templates/main/unsubscribe_result.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Email Preferences{% endblock %}

{% block content %}
<section class="container max-w-700 py-4">
  <header class="mb-3 text-center">
    <h1 class="page-title">Email Preferences</h1>
  </header>

  {% url 'account_info_settings' as settings_url %}

  {% if ok %}
    <div class="alert alert-success">
      <p class="mb-1">
        You’ve been unsubscribed from <strong>{{ category_label }}</strong>.
      </p>

      {% if user.is_authenticated %}
        <p class="mb-0">
          You can change this anytime on your
          <a class="alert-link" href="{{ settings_url }}?section=email-prefs#email-prefs">Settings → Email</a> page.
        </p>
      {% else %}
        {% with next_target=settings_url|add:'?section=email-prefs#email-prefs' %}
          <p class="mb-0">
            Want to review your preferences later?
            <a class="alert-link" href="{% url 'login' %}?next={{ next_target|urlencode }}">Log in</a>.
          </p>
        {% endwith %}
      {% endif %}
    </div>

    <div class="text-center mt-3 d-flex gap-2 justify-content-center">
      {% if user.is_authenticated %}
        <a href="{{ settings_url }}?section=email-prefs#email-prefs" class="btn btn-cta">Go to Email Settings</a>
      {% else %}
        {% with next_target=settings_url|add:'?section=email-prefs#email-prefs' %}
          <a href="{% url 'login' %}?next={{ next_target|urlencode }}" class="btn btn-cta">Log in to Manage Email</a>
        {% endwith %}
      {% endif %}
      <a href="{% url 'home' %}" class="btn btn-outline-secondary">Return Home</a>
    </div>

  {% else %}
    <div class="alert alert-danger">
      <p class="mb-0">{{ error }}</p>
      {% if not user.is_authenticated %}
        {% with next_target=settings_url|add:'?section=email-prefs#email-prefs' %}
          <div class="mt-2">
            <a class="alert-link" href="{% url 'login' %}?next={{ next_target|urlencode }}">Log in</a> to manage your email preferences.
          </div>
        {% endwith %}
      {% endif %}
    </div>

    <div class="text-center mt-3">
      <a href="{% url 'home' %}" class="btn btn-outline-secondary">Return Home</a>
    </div>
  {% endif %}
</section>
{% endblock %}